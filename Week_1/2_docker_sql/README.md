## Docker ##

Docker is a tool that delivers software in containers, which are isolated from each other, and contain all code and dependencies required to run some service or task (for example, data pipeline). Containers are very useful to Data Engineers because they allow us to bundle computinh environments, dependencies, and other important elements into tidy packages that can be run by anyone(no matter with operating system they are using or packages they have already installed).

### Advantages ###

* Rapid Deployment
* Security
* Simplicity and Faster Configurations
* CI efficiency - <sub><sup>(Continuous Integration) is the practice of automating the integration of code changes from mutiples contributors into a single software project.</sub></sup>

#### Data Engineer Advantages #####
* Easy Reproducibility data pipelines in different enviroments.
* Local Experiments / Integrations Tests (github actions or jenkins)
* Deploy pipelines in the cloud
* Spark, Serverless(AWS Lamda, Google functions) services


Docker containers are also stateless. This means that when you start and stop a container, you lose any changes. When we create more sopthisticated Docker instructions, we will mount volumes.

#### Volumes ####
Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.
Advantages:
* Easier to backup or migrate
* Manage volumes using Docker Cli or the docker API
* Volumes can be more safely shared among mutiple containers



## Data Pipeline ##

A data pipelin is a procress/service of moving data from one place (the source) to a destination (such as data warehouse).

Example: Reading CSV file, transforming the data somehow and storing it as a table in a PostrgreSQL database.

## Dockerfile Syntax ##
Instructions are written in uppercase and specific arguments are lowercase.
'''
INSTRUCTION arguments
'''

Run docker in ubuntu
'''
docker run -it ubuntu bash
'''


Run docker in python and with bash
'''
docker run -it python:3.9
'''

Run docker in python and entrypoint with bash.
The --entrypoint flag in the docker run command allows you to override the default ENTRYPOINT specified in the Docker image with a different command.
'''
docker run -it --entrypoint=bash python:3.9
'''


Build from dockerFile:
'''
docker build -t test:pandas .
'''
Run Container:
'''
docker run -it test:pandas
'''


## Running Postgres in a container ##

You can effortlessly deploy a containerized Postgres instance without the need for any intricate installation procedures. Simply configure a set of environment variables and designate a volume for data storage.

*Step 1:* pull the PostgreSQL docker image that we will use throughout the zoomcamp.



'''
docker pull postgres:13
''' 

Begin by creating a directory of your choice where Postgres will store its data; for instance, let's name it "ny_taxi_postgres_data." To initiate the container, use the following command:


'''
docker run -it \
    -e POSTGRES_USER="root" \
    -e POSTGRES_PASSWORD="root" \
    -e POSTGRES_DB="ny_taxi" \
    -v c:/Users/emahc/OneDrive/Documents/ZoomCamp_Data_Engineer/Week_1/2_docker_sql/ny_taxi_postgres_data:/var/lib/postgresql/data \
    -p 5432:5432 \
    postgres:13

$(pwd)=c:/Users/emahc/OneDrive/Documents/ZoomCamp_Data_Engineer/Week_1/2_docker_sql
'''


The container configuration relies on three essential environment variables:

POSTGRES_USER: This is the username used to access the database, and for this example, we've set it to "root." It's important to note that these values are intended for testing purposes only, so please modify them for any production projects.

POSTGRES_PASSWORD: This variable represents the database password, which we've also set to "root."

POSTGRES_DB: This variable specifies the name of the database, and in this case, we've chosen "ny_taxi."

The -v flag denotes the volume directory, using a colon (":") to separate the path on the host computer from the path within the container. Ensure that the path names are absolute. If you're using a UNIX-like system, you can employ the pwd command to quickly reference your local folder. This example is compatible with both bash and zsh shells, but for the fish shell, you should omit the "$" symbol.

It's imperative to run this command from a directory containing the "ny_taxi_postgres_data" subdirectory that you previously created.

The -p flag facilitates port mapping, enabling us to link the default Postgres port to the same port on the host.

Finally, the last argument specifies the image name and its version tag, launching the official PostgreSQL image with version 13.


# pgcli Installation and Usage Guide

## Installation

To install `pgcli`, a command-line interface for PostgreSQL with enhanced features, you can use the following `pip` command:

'''
pip install pgcli
'''
Usage
After installing pgcli, you can connect to a PostgreSQL database using the following command:

'''
pgcli -h localhost -p 5432 -u root -d ny_taxi
'''

Connection Options
-h or --host: Specifies the host where the PostgreSQL server is running. In the example, it is set to localhost.
-p or --port: Specifies the port number on which the PostgreSQL server is listening. In the example, it is set to 5432.
-u or --user: Specifies the username for connecting to the PostgreSQL database. In the example, it is set to root.
-d or --database: Specifies the name of the PostgreSQL database to which you want to connect. In the example, it is set to ny_taxi.
Password
When prompted for the password, enter root as the password.


Password: root
Make sure to replace localhost, 5432, root, and ny_taxi with the appropriate values for your PostgreSQL setup.

Juypter Notebook steps:

1.
'''
pip install sqlalchemy
'''
2. Access file load_data_postgresql.ipynb


Connect pgAdmin
1.
'''
docker run -it \
    -e PGADMIN_DEFAULT_EMAIL="admin@admin.com" \
    -e PGADMIN_DEFAULT_PASSWORD="root" \
    -p 8080:80 \
    dpage/pgamin4
'''

Explanation of Parameters:
-e PGADMIN_DEFAULT_EMAIL: Set the default email for the initial administrator account. Change "admin@admin.com" to your preferred email address.

-e PGADMIN_DEFAULT_PASSWORD: Set the default password for the initial administrator account. Change "root" to your preferred password.

-p 8080:80: Map port 8080 on the host machine to port 80 on the container. Adjust the host port if needed.


Google steps

1. set GOOGLE_APPLICATION_CREDENTIALS="xxxxx"
2. gcloud auth application-default login